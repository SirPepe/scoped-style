{"version":3,"sources":["src/scoped-style.js"],"names":["window","ScopedStyle","escapeRegExp","str","replace","createScope","Math","random","toString","slice","Date","now","splitSelector","input","result","index","quote","i","length","indexOf","map","Function","prototype","call","bind","String","trim","findChildren","node","selector","descendants","querySelectorAll","filter","descendant","parentNode","rewriteSelector","scope","s","match","scopeSelectorRe","join","rewriteRule","rule","reSelector","RegExp","selectorText","css","cssText","rewriteRules","source","rules","cssRules","type","newCssText","deleteRule","insertRule","setScope","forEach","classList","className","scopeClassRe","styleNodes","remove","add","document","registerElement","extends","Object","create","HTMLStyleElement","attachedCallback","value","this","setAttribute","sheet"],"mappings":"AAAAA,OAAOC,YAAcD,OAAOC,aAAe,WACzC,YAEA,SAASC,GAAcC,GACrB,MAAOA,GAAIC,QAAQ,sCAAuC,QAM5D,QAASC,KACP,MAAO,SAAWC,KAAKC,SAASC,SAAS,IAAIC,MAAM,GAAK,IAAMC,KAAKC,MAGrE,QAASC,GAAcC,GAIrB,IAAI,GAHAC,MACAC,EAAQ,EACRC,GAAQ,EACJC,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IACH,mBAAlBH,GAAOC,KACfD,EAAOC,GAAS,IAEF,MAAbF,EAAMI,IAAcD,KAAU,EAC/BD,MAEI,IAAK,KAAKI,QAAQN,EAAMI,WACvBD,KAAU,EACXA,EAAQH,EAAMI,GACND,IAAUH,EAAMI,KACxBD,GAAQ,IAGZF,EAAOC,IAAUF,EAAMI,GAG3B,OAAOH,GAAOM,IAAIC,SAASC,UAAUC,KAAKC,KAAKC,OAAOH,UAAUI,OAGlE,QAASC,GAAcC,EAAMC,GAC3B,GAAIC,GAAcF,EAAKG,iBAAiBF,EACxC,UAAUG,OAAOT,KAAKO,EAAa,SAAUG,GAC3C,MAAQA,GAAWC,aAAeN,IAOtC,QAASO,GAAiBN,EAAUO,GAClC,MAAOxB,GAAciB,GAClBT,IAAI,SAASiB,GACZ,MAAGR,GAASS,MAAMC,GACT,IAAMH,EAAQC,EAAEjC,QAAQmC,EAAiB,IAEzC,IAAMH,EAAQ,IAAMC,IAG9BG,KAAK,KAKV,QAASC,GAAaC,EAAMN,GAC1B,GAAIO,GAAa,GAAIC,QAAO,QAAU1C,EAAawC,EAAKG,eACpDC,EAAMJ,EAAKK,QAAQ3C,QAAQuC,EAAY,IACvCd,EAAWM,EAAgBO,EAAKG,aAAcT,EAClD,OAAOP,GAAWiB,EAGpB,QAASE,GAAcC,EAAQb,GAE7B,IAAK,GADDc,GAAQD,EAAOE,SACVlC,EAAI,EAAGA,EAAIiC,EAAMhC,OAAQD,IAChC,OAAQiC,EAAMjC,GAAGmC,MACf,IAAK,GACH,GAAIC,GAAaZ,EAAYS,EAAMjC,GAAImB,EACvCa,GAAOK,WAAWrC,GAClBgC,EAAOM,WAAWF,EAAYpC,EAC9B,MACF,KAAK,GACH+B,EAAaE,EAAMjC,GAAImB,IAQ/B,QAASoB,GAAU5B,EAAMQ,MAKpBqB,QAAQlC,KAAKK,EAAK8B,UAAW,SAAUC,GACxC,GAAGA,EAAUrB,MAAMsB,GAAc,CAC/B,GAAIC,GAAalC,EAAaC,EAAM,gBAAkB+B,EAAY,KACzC,KAAtBE,EAAW3C,QACZU,EAAK8B,UAAUI,OAAOH,MAI5B/B,EAAK8B,UAAUK,IAAI3B,GA7FrB,GAAIwB,GAAe,6BACfrB,EAAkB,2BA+FtB,OAAOyB,UAASC,gBAAgB,gBAC9BC,QAAS,QACT5C,UAAW6C,OAAOC,OAAOpE,OAAOqE,iBAAiB/C,WAC/CgD,kBACEC,MAAO,WACL,GAAInC,GAAQ/B,GACZmE,MAAKC,aAAa,aAAcrC,GAChCY,EAAawB,KAAKE,MAAOtC,GACzBoB,EAASgB,KAAKtC,WAAYE,KAG9BlC,cAAgBqE,MAAOrE,GACvBG,aAAekE,MAAOlE,GACtBO,eAAiB2D,MAAO3D,GACxBe,cAAgB4C,MAAO5C,GACvBQ,iBAAmBoC,MAAOpC,GAC1BM,aAAe8B,MAAO9B,GACtBO,cAAgBuB,MAAOvB,GACvBQ,UAAYe,MAAOf","file":"dist/scoped-style.min.js","sourcesContent":["window.ScopedStyle = window.ScopedStyle || (function(){\n  \"use strict\";\n\n  function escapeRegExp (str) {\n    return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n  }\n\n  var scopeClassRe = /\\bscope-[a-z0-9]*-[0-9]*\\b/;\n  var scopeSelectorRe = /(?:^|\\s|\\n|\\W)*-x-scope\\b/;\n\n  function createScope () {\n    return 'scope-' + Math.random().toString(36).slice(2) + '-' + Date.now();\n  }\n\n  function splitSelector(input){\n    var result = [];\n    var index = 0;\n    var quote = false;\n    for(var i = 0; i < input.length; i++){\n      if(typeof result[index] === 'undefined'){\n        result[index] = '';\n      }\n      if(input[i] === ',' && quote === false){\n        index++;\n      } else {\n        if(['\"', \"'\"].indexOf(input[i]) !== -1){\n          if(quote === false){\n            quote = input[i];\n          } else if(quote === input[i]) {\n            quote = false;\n          }\n        }\n        result[index] += input[i];\n      }\n    }\n    return result.map(Function.prototype.call.bind(String.prototype.trim));\n  }\n\n  function findChildren (node, selector) {\n    var descendants = node.querySelectorAll(selector);\n    return [].filter.call(descendants, function (descendant) {\n      return (descendant.parentNode === node);\n    });\n  }\n\n  // Remove all occurrences of \"-x-scope\" in a selector and add the scope as\n  // a class selector before. When replacing -x-scope with the class selector,\n  // add no space afterwards to make stuff like -x-scope[foo=bar] work\n  function rewriteSelector (selector, scope) {\n    return splitSelector(selector)\n      .map(function(s){\n        if(selector.match(scopeSelectorRe)){\n          return '.' + scope + s.replace(scopeSelectorRe, '');\n        } else {\n          return '.' + scope + ' ' + s;\n        }\n      })\n      .join(',');\n  }\n\n  // Remove and replace the rule's selector because there's no other way to only\n  // get a string of all declarations\n  function rewriteRule (rule, scope) {\n    var reSelector = new RegExp('^\\\\s*' + escapeRegExp(rule.selectorText));\n    var css = rule.cssText.replace(reSelector, '');\n    var selector = rewriteSelector(rule.selectorText, scope);\n    return selector + css;\n  }\n\n  function rewriteRules (source, scope) {\n    var rules = source.cssRules;\n    for (var i = 0; i < rules.length; i++) {\n      switch (rules[i].type) {\n        case 1: // StyleRule\n          var newCssText = rewriteRule(rules[i], scope);\n          source.deleteRule(i);\n          source.insertRule(newCssText, i);\n          break;\n        case 4: // MediaRule\n          rewriteRules(rules[i], scope);\n          break;\n        default: // Don't touch other rules\n          break;\n      }\n    }\n  }\n\n  function setScope (node, scope) {\n    // Remove scope classes for which no child style node (identified by its\n    // data-scope property) can be found. This is required to keep scopes unique\n    // when cloning style elements while still supporting multiple scoped style\n    // elements per parent node\n    [].forEach.call(node.classList, function (className) {\n      if(className.match(scopeClassRe)){\n        var styleNodes = findChildren(node, '[data-scope=\"' + className + '\"]');\n        if(styleNodes.length === 0){\n          node.classList.remove(className);\n        }\n      }\n    });\n    node.classList.add(scope);\n  }\n\n  return document.registerElement('scoped-style', {\n    extends: 'style',\n    prototype: Object.create(window.HTMLStyleElement.prototype, {\n      attachedCallback: {\n        value: function () {\n          var scope = createScope();\n          this.setAttribute('data-scope', scope);\n          rewriteRules(this.sheet, scope);\n          setScope(this.parentNode, scope);\n        }\n      },\n      escapeRegExp: { value: escapeRegExp },\n      createScope: { value: createScope },\n      splitSelector: { value: splitSelector },\n      findChildren: { value: findChildren },\n      rewriteSelector: { value: rewriteSelector },\n      rewriteRule: { value: rewriteRule },\n      rewriteRules: { value: rewriteRules },\n      setScope: { value: setScope }\n    })\n  });\n\n})();"]}